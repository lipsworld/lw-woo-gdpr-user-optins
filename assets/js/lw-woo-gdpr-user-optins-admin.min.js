function clearNewFieldInputs(e){if(jQuery(".lw-woo-gdpr-user-optins-new-fields-row").map(function(){jQuery(this).find("input[type=text]").val(""),jQuery(this).find("input[type=checkbox]").prop("checked",!1)}),jQuery(".lw-woo-gdpr-user-optins-new-fields-row #lw-woo-gdpr-user-optin-title-new").focus(),e){var t=jQuery("tr.lw-woo-gdpr-user-optins-new-fields-row span.lw-woo-gdpr-user-optins-field-new-success");t.removeClass("lw-woo-gdpr-user-optins-field-hidden"),hideAgain=setTimeout(function(){t.addClass("lw-woo-gdpr-user-optins-field-hidden")},3e3)}}function fixWidthHelper(e,t){return t.children().map(function(){jQuery(this).width(jQuery(this).width())}),t}jQuery(document).ready(function(n){var s="body.lw-woo-gdpr-user-optins-admin-tab",e="form#mainform",r=!1,d="table.lw-woo-gdpr-user-optins-list-table-wrap",a="table.lw-woo-gdpr-user-optins-list-table-wrap tbody";0<d.length&&n(a).sortable({handle:".lw-woo-gdpr-user-optins-field-trigger-icon",helper:fixWidthHelper,update:function(e,t){var o={action:"lw_woo_gdpr_optins_sort",sorted:n(a).sortable("toArray",{attribute:"data-key"})};jQuery.post(ajaxurl,o)}}),0<n("body.lw-woo-gdpr-user-optins-admin-tab").length&&(n(e).on("click","button",function(){r=n(this).hasClass("lw-woo-gdpr-user-optin-add-new-button")}),n(e).submit(function(e){if(!0===r){e.preventDefault(),n(".woo-nav-tab-wrapper a").off();var t=document.getElementById("lw_woo_gdpr_new_optin_nonce").value;if(""===t||void 0===t)return!1;var o={action:"lw_woo_gdpr_optins_add_new",required:n("input#lw-woo-gdpr-user-optin-required-new").is(":checked"),title:document.getElementById("lw-woo-gdpr-user-optin-title-new").value,label:document.getElementById("lw-woo-gdpr-user-optin-label-new").value,nonce:t};jQuery.post(ajaxurl,o,function(e){if(n(a).sortable("refreshPositions"),!0!==e.success)return n(s).find(".woocommerce h1:first").after(e.data.notice),!1;""!==e.data.markup&&(clearNewFieldInputs(!0),n("table#lw-woo-gdpr-user-optins-list-table tr:last").after(e.data.markup))},"json")}}),n(d).on("click","a.lw-woo-gdpr-user-optins-field-trigger-trash",function(e){e.preventDefault();var t=n(this).parents("tr.lw-woo-gdpr-user-optins-single-row"),o=n(this).data("field-id"),r=n(this).data("nonce");if(""===r||void 0===r)return!1;if(""===o||void 0===o)return!1;var i={action:"lw_woo_gdpr_optins_delete_row",field_id:o,nonce:r};jQuery.post(ajaxurl,i,function(e){if(n(a).sortable("refreshPositions"),!0!==e.success)return n(s).find(".woocommerce h1:first").after(e.data.notice),!1;!0!==e.success&&"true"!==e.success||n(d).find(t).fadeOut(500,function(){n(this).remove()})},"json")}),n(s).on("click",".notice-dismiss",function(){n(s).find(".lw-woo-gdpr-user-optins-admin-message").remove()}))});