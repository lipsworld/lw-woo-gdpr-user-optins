jQuery(document).ready(function(a){var n=!1,d=a("body.lw-woo-gdpr-user-optins-admin-tab"),e=a("table.lw-woo-gdpr-user-optins-list-table-wrap"),s=a("table.lw-woo-gdpr-user-optins-list-table-wrap tbody"),o=a("body.lw-woo-gdpr-user-optins-admin-tab form#mainform");0<e.length&&s.sortable({handle:".lw-woo-gdpr-user-optins-field-trigger-icon",containment:e,update:function(e,o){var t={action:"lw_woo_gdpr_optins_sort",sorted:s.sortable("toArray",{attribute:"data-key"})};jQuery.post(ajaxurl,t)}}),0<d.length&&(o.on("click","button",function(){n=a(this).hasClass("lw-woo-gdpr-user-optin-add-new-button")}),o.submit(function(e){if(!0===n){e.preventDefault(),a(".woo-nav-tab-wrapper a").off();var o=document.getElementById("lw_woo_gdpr_new_optin_nonce").value;if(""===o||void 0===o)return!1;var t={action:"lw_woo_gdpr_optins_add_new",required:a("input#lw-woo-gdpr-user-optin-required-new").is(":checked"),title:document.getElementById("lw-woo-gdpr-user-optin-title-new").value,label:document.getElementById("lw-woo-gdpr-user-optin-label-new").value,nonce:o};jQuery.post(ajaxurl,t,function(e){if(s.sortable("refreshPositions"),!0!==e.success)return void 0!==e.data&&void 0!==e.data.notice&&""!==e.data.notice&&d.find(".woocommerce h1:first").after(e.data.notice),!1;var o,t;void 0!==e.data&&void 0!==e.data.markup&&""!==e.data.markup&&(o=a("tr.lw-woo-gdpr-user-optins-new-fields-row"),t=o.find("span.lw-woo-gdpr-user-optins-field-new-success"),o.find("#lw-woo-gdpr-user-optin-required-new").prop("checked",!1),o.find("#lw-woo-gdpr-user-optin-title-new").val("").focus(),o.find("#lw-woo-gdpr-user-optin-label-new").val(""),t.removeClass("lw-woo-gdpr-user-optins-field-hidden"),hideAgain=setTimeout(function(){t.addClass("lw-woo-gdpr-user-optins-field-hidden")},3e3),s.find("tr:last").after(e.data.markup))},"json")}}),s.on("click","a.lw-woo-gdpr-user-optins-field-trigger-trash",function(e){e.preventDefault();var o=a(this),t=o.parents("tr.lw-woo-gdpr-user-optins-single-row"),n=o.data("field-id"),r=o.data("nonce");if(""===r||void 0===r)return!1;if(""===n||void 0===n)return!1;var i={action:"lw_woo_gdpr_optins_delete_row",field_id:n,nonce:r};jQuery.post(ajaxurl,i,function(e){if(s.sortable("refreshPositions"),!0!==e.success)return void 0!==e.data&&void 0!==e.data.notice&&""!==e.data.notice&&d.find(".woocommerce h1:first").after(e.data.notice),!1;!0!==e.success&&"true"!==e.success||t.fadeOut(500,function(){t.remove()})},"json")}),d.on("click",".notice-dismiss",function(){d.find(".lw-woo-gdpr-user-optins-admin-message").remove()}))});